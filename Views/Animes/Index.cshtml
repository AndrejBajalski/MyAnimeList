@using Models.DomainModels

@model List<Anime>
@{
	ViewData["Title"] = "All";
	Layout = "~/Pages/Shared/_Layout.cshtml";
}

@if (TempData["Error"] != null)
{
	ViewData["MessageType"] = "error";
	ViewData["Message"] = TempData["Error"];
	@await Html.PartialAsync("InfoBox", ViewData)
}
@if (TempData["Message"] != null)
{
	ViewData["MessageType"] = TempData["MessageType"];
	ViewData["Message"] = TempData["Message"];
	@await Html.PartialAsync("InfoBox", ViewData)
}

<h1>All Animes</h1>
<div class="main">
	<form asp-action="Index" method="get" class="keyword-search-form">
		<input type="text" name="keyword" placeholder="Search anime" />
		<button type="submit" class="btn bg-lilac-1">Search</button>
	</form>
	<div class="row">
		@for(int i=0; i<Model.Count; i++)
		{
			var anime = Model[i];
			<div class="col-4 p-3">
				<div class="card">
					<img src="@anime.ImageUrl" alt="@anime.Name" class="card-img-top" style="max-height: 300px;"/>
					<div class="card-body">
						<h4 class="card-title mb-3">@anime.Name</h4>
						<p><strong>Year aired: </strong> @anime.YearAired</p>
						<p><strong>Genre: </strong>
							@foreach (var genre in anime.Genres)
							{
								<span>
									@genre 
								</span>

							}
						</p>
						<p><strong>Number of episodes: </strong>@anime.NumberOfEpisodes</p>
						<p><strong>Rating: </strong>@anime.Rating</p>
						<p><strong>Synopsis: </strong>
							@if (!string.IsNullOrEmpty(anime.Description) && anime.Description.Length > 100)
							{
								@anime.Description.Substring(0, 100) <a asp-controller="Animes" asp-action="GetAnimeById" asp-route-id="@anime.Id"> See more </a>
							}
							else
							{
								@anime.Description
							}
						</p>
					</div>
					<div>
						<a asp-controller="Animes" asp-action="AddToList" asp-route-id="@anime.Id" class="btn btn-primary">Add To List</a>
					</div>
				</div>
			</div>
		}
	</div>
	<form asp-action="Index" method="get" class="pages-bar">
		@{
			int prev = ViewBag.Page.current_page  - 1;
			int next = ViewBag.Page.current_page  + 1;
		}
		<button type="submit" disabled="@(prev<1)" name="page" value="@next">Previous page</button>
		<span>Page @ViewBag.Page.current_page out of @ViewBag.Page.last_visible_page</span>
		<button type="submit" disabled="@(!ViewBag.Page.has_next_page)" name="page" value="@next">Next page</button>
	</form>
</div>

<style>
	.main{
		display: flex;
		justify-content: center;
		padding: 1rem 10%;
		flex-wrap: wrap;
	}
	.main row .card {
		width: 550px;
	}
	.pages-bar{
		width: 70%;
		text-align: center;
		margin: 1rem 0;
	}
	.keyword-search-form{
		font-size: 1.2rem;
		margin-bottom: 3rem;
		width: 70%;
		display: flex;
		align-items: center;
	}
	.keyword-search-form input {
		width: 80%;
		height: 2rem;
		box-sizing: border-box;
		padding: 20px 10px;
		border-radius: 10px;
		margin-right: 10px;
		border-color: #832be3;
	}

    .keyword-search-form button{
		width: 15%;
		font-size: 1.2rem;
		height: 40px;
		box-sizing: border-box;
		color: white;
	}
</style>