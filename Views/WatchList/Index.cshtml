@using Models.DomainModels
@using Models.Enums

@model List<UnwatchedAnime>

@{
	AnimeStatus nextStatus = AnimeStatus.PlanToWatch;
	string actionName;
	bool canPause=false, completed=false;
}
@if (TempData["Message"] != null)
{
	ViewData["MessageType"] = TempData["MessageType"];
	ViewData["Message"] = TempData["Message"];
	@await Html.PartialAsync("InfoBox", ViewData)
}

<h1 class="mt-3">Your Watch List</h1>

<div style="margin: 0 15%">
<div class="status-navbar" >
	<a class=@(ViewBag.Status==AnimeStatus.All ? "selected" : "") asp-action="Index">All (@ViewBag.StatusCount[AnimeStatus.All])</a>
	<a class="@(ViewBag.Status==AnimeStatus.PlanToWatch ? "selected" : "")" asp-action="Index" asp-route-status="@(AnimeStatus.PlanToWatch)">Planned (@ViewBag.StatusCount[AnimeStatus.PlanToWatch])</a>
	<a class="@(ViewBag.Status==AnimeStatus.Watching ? "selected" : "")" asp-action="Index" asp-route-status="@(AnimeStatus.Watching)">Watching (@ViewBag.StatusCount[AnimeStatus.Watching])</a>
	<a class="@(ViewBag.Status==AnimeStatus.Completed ? "selected" : "")" asp-action="Index" asp-route-status="@(AnimeStatus.Completed)">Completed (@ViewBag.StatusCount[AnimeStatus.Completed])</a>
	<a class="@(ViewBag.Status==AnimeStatus.Paused ? "selected" : "")" asp-action="Index" asp-route-status="@(AnimeStatus.Paused)">Paused (@ViewBag.StatusCount[AnimeStatus.Paused])</a>
</div>

<form asp-controller="WatchList" class="d-flex flex-column align-items-center">
	@{
		if(Model.Count == 0)
		{
			<h2 class="text-secondary m-4">No saved movies in this category</h2>
		}
		for(int i=0; i<Model.Count; i++)
		{
			<div class="row row-@(i%2)">
				<div class="col-4">
					<img src="@Model[i].Anime.ImageUrl" alt="@Model[i].Anime.Name"/>
				</div>
				<div class="col-3">
					<h3>@Model[i].Anime.Name</h3>
					<div><strong>Title Japanese: </strong>@Model[i].Anime.NameJapanese</div>
				</div>
				<div class="col-2">
					<div><strong>Status:</strong></div>
					<div>
						@await Html.PartialAsync("StatusDot", Model[i].Status)
					</div>
				</div>
				<div class="col-3 d-flex flex-column justify-content-between">
					@switch (Model[i].Status)
					{
						case AnimeStatus.PlanToWatch:
							nextStatus = AnimeStatus.Watching;
							actionName = "Start Watching";
							canPause = false;
							completed = false; break;
						case AnimeStatus.Watching:
							nextStatus = AnimeStatus.Completed;
							actionName = "Add to Completed";
							canPause = true;
							completed = false; break;
						case AnimeStatus.Paused:
							nextStatus = AnimeStatus.Watching;
							actionName = "Continue Watching";
							canPause = false;
							completed = false; break;
						case AnimeStatus.Completed:
							completed = true;
							canPause = false;
							actionName = "Rate"; break;
						default:
							nextStatus = AnimeStatus.Watching;
							actionName = "Start Watching";
							canPause = false;
							completed = false; break;
					}
					@if(completed){
						<button type="submit" class="btn btn-success m-2" asp-action="AddRating" asp-route-id="@Model[i].Id">Add Rating</button>
					}else{
						<button type="submit" class="btn btn-primary m-2" asp-action="UpdateStatus" asp-route-id="@Model[i].Id" asp-route-status="@nextStatus">@actionName</button>
					}
					@if (canPause)
					{
						<button type="submit" class="btn btn-warning m-2" asp-action="UpdateStatus" asp-route-id="@Model[i].Id" asp-route-status="@(AnimeStatus.Paused)">Pause</button>
					}
					<button type="submit" class="btn btn-danger m-2" asp-action="RemoveFromList" asp-route-id="@Model[i].Id">Remove from list</button>
				</div>
			</div>
		}
	}
</form>
</div>
<style>
	.status-navbar{
		display: flex;
		justify-content: space-around;
		background-color: #4343E0;
		padding: 1rem 0;
		margin-top: 5%;
	}
	.status-navbar a{
		text-decoration: none;
		font-size: 1.5rem;
		font-weight: bold;
		color: white;
	}
	.status-navbar a.selected{
		background-color: #832be3;
	}
	.row{
		width: 100%;
		display: flex;
		align-items: center;
		box-sizing: border-box;
		padding: 1rem 0;
	}
	.row-1{
		background-color: lightgray;
	}
</style>